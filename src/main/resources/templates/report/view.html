<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorate="~{fragments/layout :: layout(title='보고서 조회')}">

<th:block layout:fragment="css">
    <link rel="stylesheet" th:href="@{css/layout.css}">
    <style>
        /* 여기에 CSS를 입력 */
    </style>
</th:block>

<th:block layout:fragment="script">
    <script th:src="@{js/example.js}"></script>
    <script th:inline="javascript">
        function toggleRejectionReason() {
            var status = document.getElementById("status").value;
            var rejectionReasonContainer = document.getElementById("rejectionReasonContainer");
            if (status === "거절") {
                rejectionReasonContainer.style.display = "block";
            } else {
                rejectionReasonContainer.style.display = "none";
            }
        }
    </script>
</th:block>

<div layout:fragment="~{content}">
    <div class="content">
        <h1 th:text="${report.title}">제목</h1>
        <p th:text="'내용: ' + ${report.content}">내용</p>
        <p th:text="'업무 처리 날짜: ' + ${report.completeDate}">업무 처리 날짜</p>
        <p th:text="'작성일: ' + ${report.createdDate}">작성일</p>
        <p th:text="'결재자: ' + ${report.approverId}">결재자</p>
        <p th:text="'결재 상태: ' + ${report.status}">결재 상태</p>
        <!-- 결재 상태가 거절일 경우에만 거절 사유를 표시 -->
        <p th:if="${report.status == '거절'}" th:text="'거절 사유: ' + ${report.rejectReason}">거절 사유</p>

        <!-- 결재 상태 변경 기능 -->
        <form th:action="@{/report/approve}" method="post">
            <input type="hidden" name="reportId" th:value="${report.reportId}" />
            <div>
                <label for="status">결재 상태:</label>
                <select id="status" name="status" onchange="toggleRejectionReason()">
                    <option value="승인">승인</option>
                    <option value="거절">거절</option>
                </select>
            </div>
            <div id="rejectionReasonContainer" style="display: none;">
                <label for="rejectionReason">거절 사유:</label>
                <textarea id="rejectionReason" name="rejectionReason"></textarea>
            </div>
            <button type="submit">결재 상태 변경</button>
        </form>

        <div th:if="${reportFile != null}">
            <p>
                첨부 파일:
                <a th:href="${reportFile.cloudServerFileUrl}" th:text="${reportFile.originalFileName}">파일 이름</a>
            </p>
        </div>
        <a th:href="@{'/report/edit?reportId=' + ${report.reportId}}">수정</a>

        <form th:action="@{'/report/delete/' + ${report.reportId}}" method="post" style="display:inline;">
            <input type="hidden" name="_method" value="delete">
            <button type="submit" onclick="return confirm('정말 이 보고서를 삭제하시겠습니까?');">삭제</button>
        </form>

        <a th:href="@{/report/main}">목록으로</a>
    </div>
</div>
</html>
