<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorate="~{fragments/layout-with-modal :: layout(title='보고서')}">

<th:block layout:fragment="css">
    <link rel="stylesheet" th:href="@{/css/layout.css}">
    <style>
        /* 여기에 CSS를 입력 */
        .table-container {
            width: 100%;
            margin-top: 20px;
            overflow-x: auto; /* 표가 깨지지 않도록 스크롤 추가 */
        }

        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: auto; /* 테이블의 레이아웃을 자동으로 설정 */
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            white-space: nowrap; /* 셀 내용이 한 줄로 표시되도록 설정 */
        }

        th {
            background-color: #f2f2f2;
            text-align: left;
            cursor: default;
        }

        tr:hover {
            cursor: pointer;
        }

        a {
            text-decoration: none;
            color: black;
        }

        a:hover {
            text-decoration: underline;
            cursor: pointer;
        }

        .flex-container {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap; /* 창 크기가 작아지면 flex 아이템들이 줄바꿈 되도록 설정 */
        }

        .flex-item {
            width: 48%;
            min-width: 300px; /* 최소 너비 설정 */
            margin-bottom: 20px; /* 아래쪽 여백 추가 */
        }

        /* 표가 깨지지 않게 하기 위해 제목 최대 너비를 설정 */
        .title {
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            text-align: center;
        }

        /* 공통 열 스타일 */
        .narrow-column {
            width: 100px;
            text-align: center;
        }

        /* 반응형 디자인을 위한 미디어 쿼리 */
        @media (max-width: 768px) {
            .flex-item {
                width: 100%;
            }
        }
    </style>
</th:block>

<th:block layout:fragment="script">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        google.charts.load('current', {'packages': ['bar']});
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {
            // hidden-stats 요소에서 데이터를 읽어와서 파싱
            var stats = JSON.parse(document.getElementById('hidden-stats').textContent);
            var data = google.visualization.arrayToDataTable(stats);

            var options = {};

            var chart = new google.charts.Bar(document.getElementById('columnchart_material'));
            chart.draw(data, google.charts.Bar.convertOptions(options));
        }
    </script>
    <script th:src="@{/js/report.js}"></script>
</th:block>

<div layout:fragment="~{content}">
    <div class="content">
        <!-- 여기에 추가 컨텐츠를 넣으면 됨 -->
        <div class="flex-container">
            <div class="flex-item">
                <h1 style="margin-right: 20px;">보고서 목록</h1>
                <button onclick="location.href='/report/write'">보고서 작성하기</button>
                <div class="table-container">
                    <table class="list">
                        <thead>
                        <tr>
                            <th class="title">제목</th>
                            <th class="">결재자</th>
                            <th class="narrow-column">결재 상태</th>
                            <th class="narrow-column">작성일</th>
                        </tr>
                        </thead>
                        <tbody>
<!--                        <tr th:each="report : ${reports}" th:reportId="${report.reportId}"-->
<!--                            th:onclick="'location.href=\'/report/' + ${report.reportId} + '\';'">-->

                        <tr th:each="report : ${reports}" th:reportId="${report.reportId}"
                            th:onclick="openModal('/report/' + this.getAttribute('reportId'))">
                            <td class="title" th:text="${report.title}"></td>
                            <td class="narrow-column" th:text="${report.approverId}"></td>
                            <td class="narrow-column" th:text="${report.status}"></td>
                            <td class="narrow-column" th:text="${report.formattedCreatedDate}"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 작성 요청 목록 -->
            <div class="flex-item">
                <h1 style="margin-right: 20px;">작성 요청 목록</h1>
                <button onclick="location.href='/request/write'">작성 요청하기</button>
                <div class="table-container">
                    <table>
                        <thead>
                        <tr>
                            <th class="narrow-column">요청자</th>
                            <th class="narrow-column">마감 기한</th>
                            <th class="narrow-column">요청 일자</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="request : ${requests}" th:requestId="${request.requestId}"
                            th:onclick="openModal('/request/' + this.getAttribute('requestId'))">
                            <td class="narrow-column" th:text="${request.requesterId}"></td>
                            <td class="narrow-column" th:text="${request.formattedDueDate}"></td>
                            <td class="narrow-column" th:text="${request.formattedRequestDate}"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 보고서 통계 -->
        <div style="display: flex; align-items: center; margin-top: 20px;">
            <h1 style="margin-right: 20px;">보고서 통계</h1>
            <button onclick="location.href='/report/statistic'">통계 날짜 설정</button>
        </div>
        <!-- 구글 차트 통계 추가 -->
        <div id="columnchart_material" style="width: 800px; height: 500px;"></div>

        <!-- 숨겨진 요소에 통계 데이터를 JSON 형식으로 저장 -->
        <div id="hidden-stats" th:text="${statsJson}" style="display:none;"></div>
    </div>
</div>
</html>
