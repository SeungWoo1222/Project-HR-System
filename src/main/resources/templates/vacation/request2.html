<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorate="~{fragments/layout :: layout(title='휴가 등록')}">

<th:block layout:fragment="css">
<!--    <link rel="stylesheet" th:href="@{/css/request.css}"/>-->
</th:block>

<th:block layout:fragment="script">
    <script th:src="@{/js/vacation/request.js}"></script>
    <script>
        // 사원 선택 시 이벤트 핸들러 설정
        document.addEventListener("DOMContentLoaded", function() {
            const employeeSelect = document.getElementById("employeeId");
            if (employeeSelect) {
                employeeSelect.addEventListener("change", function () {
                    const selectedEmployeeId = this.value;
                    if (selectedEmployeeId) {
                        fetchEmployeeInfo(selectedEmployeeId); // 선택된 사원 ID로 API 요청
                    }
                });
            } else {
                console.error('employeeId 요소를 찾을 수 없습니다.');
            }
        });
    </script>
</th:block>

<div layout:fragment="~{content}">
    <div class="content">
        <form action="/api/vacation" onsubmit="submitInsertForm(event, 'HR')">
            <div class="form-group">
                <label for="employeeId">휴가 신청 사원</label>
                <select id="employeeId" name="employeeId">
                    <option value="" disabled selected>선택해주세요.</option>
                    <option th:each="employee : ${employeeList}"
                            th:value="${employee.employeeId}"
                            th:text="${employee.name} + '(' +  ${employee.employeeId} + ')'"></option>
                </select>
            </div>
            <div class="form-group">
                <label for="vacationType">휴가 유형</label>
                <select id="vacationType" name="vacationType" onchange="updateFormVisibility()">
                    <option value="" disabled selected>선택해주세요.</option>
                    <option value="오전 반차">오전 반차</option>
                    <option value="오후 반차">오후 반차</option>
                    <option value="연차">연차</option>
                    <option value="병가">병가</option>
                    <option value="출산 휴가">출산 휴가</option>
                    <option value="배우자 출산 휴가">배우자 출산 휴가</option>
                    <option value="생리 휴가">생리 휴가</option>
                    <option value="가족 돌봄 휴가">가족 돌봄 휴가</option>
                    <option value="경조사 휴가">경조사 휴가</option>
                    <option value="기타 휴가">기타 휴가</option>
                </select>
            </div>
            <div class="form-group" style="display: none">
                <label for="dateAt">휴가일</label>
                <input type="date" id="dateAt" onchange="setDateAt()"/>
            </div>
            <div class="form-group">
                <label for="startAt">휴가 시작일</label>
                <input type="date" id="startAt" name="startAt" oninput="calculateUsedDays()"/>
            </div>
            <div class="form-group">
                <label for="endAt">휴가 종료일</label>
                <input type="date" id="endAt" name="endAt" oninput="calculateUsedDays()"/>
            </div>
            <div class="form-group">
                <label for="reason">휴가 사유</label>
                <textarea id="reason" name="reason" rows="2" placeholder="휴가 사유를 입력해주세요."></textarea>
            </div>
            <div class="form-group">
                <label for="remainingLeave">잔여 연차</label>
                <input type="text" id="remainingLeave" readonly/>
            </div>
            <div class="form-group">
                <label for="usedDays">연차 사용 일수</label>
                <input type="text" id="usedDays" name="usedDays" readonly/>
            </div>
            <div id="error-message" class="error-message"></div>
            <div>
                <button type="reset" class="btn">초기화</button>
                <button type="submit" class="btn">휴가 등록</button>
            </div>
        </form>
    </div>
</div>