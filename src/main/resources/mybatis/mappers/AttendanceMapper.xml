<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.woosan.hr_system.attendance.dao.AttendanceDAO">
    <resultMap id="attendanceResultMap" type="com.woosan.hr_system.attendance.model.Attendance">
        <id property="attendanceId" column="attendance_id" />
        <result property="employeeId" column="employee_id" />
        <result property="date" column="date" />
        <result property="checkIn" column="check_in" />
        <result property="checkOut" column="check_out" />
        <result property="status" column="status" />
        <result property="vacationId" column="vacation_id" />
        <result property="tripId" column="trip_id" />
        <result property="notes" column="notes" />
        <result property="lastModified" column="last_modified" />
        <result property="modifiedBy" column="modified_by" />
    </resultMap>

    <!-- 근태 ID로 근태 정보 조회 -->
    <select id="getAttendanceById" resultMap="attendanceResultMap">
        SELECT * FROM attendance WHERE attendance_id = #{attendanceId}
    </select>

    <!-- 사원 ID로 근태 목록 조회 -->
    <select id="getAttendanceByEmployeeId" resultMap="attendanceResultMap">
        SELECT * FROM attendance WHERE employee_id = #{employeeId}
    </select>

    <!-- 모든 근태 목록 조회 -->
    <select id="getAllAttendance" resultMap="attendanceResultMap">
        SELECT * FROM attendance
    </select>

    <!-- 금일 근태 현황 조회 -->
    <select id="getTodayAttendance" resultMap="attendanceResultMap">
        SELECT * FROM attendance WHERE date = #{date}
    </select>

    <!-- 근태 등록 -->
    <insert id="insertAttendance">
        INSERT INTO attendance (employee_id, date, check_in, status, vacation_id, trip_id)
        VALUES (#{employeeId}, #{date}, #{checkIn}, #{status}, #{vacationId}, #{tripId})
    </insert>

    <!-- 퇴근 시간 업데이트 -->
    <update id="updateCheckout">
        UPDATE attendance
        SET check_out = #{checkOut}
        WHERE attendance_id = #{todayAttendanceId}
    </update>

    <!-- 조퇴 처리 -->
    <update id="updateEarlyLeave">
        UPDATE attendance
        SET check_out = #{checkOut}, status = #{status}, notes = #{notes}
        WHERE attendance_id = #{todayAttendanceId}
    </update>

    <!-- 근태 수정 -->
    <update id="updateAttendance">
        UPDATE attendance
        SET check_in = #{checkIn},
            check_out = #{checkOut},
            status = #{status},
            vacation_id = #{vacationId},
            trip_id = #{tripId},
            notes = #{notes},
            last_modified = #{lastModified},
            modified_by = #{modifiedBy}
        WHERE attendance_id = #{attendanceId}
    </update>

    <!-- 금일 근태 ID 조회 -->
    <select id="getMyTodayAttendance" resultType="int">
        SELECT attendance_id FROM attendance
        WHERE employee_id = #{employeeId} AND date = #{date}
    </select>
</mapper>